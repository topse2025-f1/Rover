# VDM++ コンポーネントドキュメント作成ガイドライン

このドキュメントは、VDM++コンポーネントの仕様書（Markdown形式）を作成・更新する際のルールを定義します。
LLM（AIアシスタント）にドキュメント作成を依頼する際は、このルールを前提条件として与えてください。

## 1. ファイル命名規則と保存場所
*   **ファイル名**: `{ClassName}_Description.md`
    *   例: `Vision_Description.md`, `RoverController_Description.md`
*   **保存場所**: `rover_vdmpp/docs/` ディレクトリ

## 2. ドキュメント全体の構造
Markdownファイルは以下の見出し構造を持つこと。

```markdown
# {ClassName} コンポーネント仕様

## 概要
(クラスの責務や概要を簡潔に記述)

## 型定義 (Types)
(カスタム型、列挙型、レコード型の定義)

## 定数定義 (Values)
(公開されている定数の定義)

## インスタンス変数と不変条件 (State & Invariants)
(状態変数と、それらに課される制約)

## オペレーション一覧
(以下、各オペレーションの詳細記述)

## UMLモデル (PlantUML)
(クラス図、ステートマシン図、シーケンス図など)
```

## 3. 型定義の記述フォーマット
`types` ブロックで定義されている型について記述すること。

### 記述テンプレート
```markdown
### `TypeName`
*   **定義**: `VDMの型定義`
*   **説明**: 型の用途や意味を記述。
```

## 4. 定数定義の記述フォーマット
`values` ブロックで定義されている定数について記述すること。

### 記述テンプレート
```markdown
### `ValueName`
*   **値**: `Value`
*   **説明**: 定数の用途や意味を記述。
```

## 5. インスタンス変数と不変条件の記述フォーマット
`instance variables` と `inv` ブロックについて記述すること。

### 記述テンプレート
```markdown
### 変数一覧
*   `varName`: `Type` := `InitialValue`
    *   **説明**: 変数の役割。

### 不変条件 (Invariant)
*   **式**: `VDMの不変条件式`
*   **説明**: 常に保持されなければならない制約条件。
```

## 6. オペレーション記述フォーマット
クラス内で定義されている全ての `operations` および `functions` について、以下のテンプレートに従って記述すること。

### 記述テンプレート
```markdown
### `operationName(arg1, arg2)`
*   **事前条件**: `VDMの事前条件式` (自然言語での補足説明)
    *   事前条件がない場合は「なし」または `true` と記述。
*   **事後条件**: `VDMの事後条件式` (自然言語での補足説明)
    *   事後条件がない場合は「なし」または `true` と記述。
*   **説明**: 
    *   操作の目的、処理ロジック、副作用（状態変化）などを日本語で記述。
*   **関連要件**: 
    *   関連する要件ID（例: V3, V4）や、機能カテゴリ（例: 安全性検証、通信管理、エラーハンドリング）を記述。
```

### 記述のポイント
1.  **網羅性**: 原則として、publicな操作は全て記載する。重要なprivate操作も必要に応じて記載する。
2.  **事前/事後条件**: VDM++ソースコードの `pre` 節および `post` 節の内容を正確に反映する。数式だけでなく、その意味を日本語で補足することが望ましい。
3.  **説明**: コード内のコメントや実装ロジックから読み取れる意図を明確にする。
4.  **関連要件**: ソースコードのヘッダコメント等に記載されている要件ID（例: `-- V3要件`）があれば必ず記載する。

## 7. UMLモデルの記述 (PlantUML)
コンポーネントの理解を助けるため、PlantUMLを用いて以下のモデルを作成・記述すること。

### 必須モデル
以下の全てのモデル項目について記述すること。
コンポーネントの特性上、特定のモデルが不要な場合は、その理由を明記すること。
モデルを記述する場合は、仕様上特に着目してほしい内容の説明を付記すること。

1.  **クラス図 (Class Diagram)**
    *   対象コンポーネントの構造、および他コンポーネントとの関係（継承、集約、依存）を表現する。
2.  **ステートマシン図 (State Machine Diagram)**
    *   コンポーネントが持つ状態と、イベントによる状態遷移を表現する。
3.  **アクティビティ図 (Activity Diagram)**
    *   主要なオペレーションの処理フローや、複雑な判断ロジックを表現する。
4.  **シーケンス図 (Sequence Diagram)**
    *   他コンポーネントとの相互作用、メッセージ交換の時系列を表現する。
5.  **コンポーネント図 (Component Diagram)**
    *   システム全体における対象コンポーネントの位置づけや、インターフェースを通じた依存関係を表現する。

### 記述のポイント
*   PlantUMLのコードブロック (` ```plantuml ... ``` `) を使用して記述する。
*   **不要な場合の記述例**: 「本コンポーネントは状態を持たないため、ステートマシン図は省略する。」
*   **必要な場合の記述例**: 「以下の図は、〇〇処理における△△の判定ロジックに注目している。」

## 8. LLMへの指示プロンプト例
新しいコンポーネントのドキュメントを作成する際は、以下のテキストをプロンプトに含めてください。

> **指示**:
> 添付したVDM++ファイルのドキュメントをMarkdown形式で作成してください。
> 作成にあたっては、`rover_vdmpp/docs/Documentation_Rules.md` のガイドラインに厳密に従ってください。
> 以下の項目を必ず含めてください：
> 1. 型定義 (Types)
> 2. 定数定義 (Values)
> 3. インスタンス変数と不変条件 (State & Invariants)
> 4. 全てのオペレーション（事前条件、事後条件、説明、関連要件を含む）
> 5. UMLモデル（クラス図、コンポーネント図、ステートマシン図、アクティビティ図、シーケンス図の全て。不要な場合は理由を記述し、必要な場合は着目点の説明を記述）
